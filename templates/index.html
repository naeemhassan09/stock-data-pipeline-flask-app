<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Investment Return & Portfolio Calculator</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
</head>
<body>
<div class="container">
    <h1 class="mt-4">Investment Return & Portfolio Calculator</h1>
    <p>This tool uses historical data to predict how much profit you could make over a specified test period. 
    Individual asset returns, as well as two portfolio allocation approaches, are computed based on the test period <strong>January 2023 – March 2023</strong>.
    All daily return values are aggregated and compounded over the test period.</p>
    
    <form method="post" class="mt-4">
        <div class="form-group">
            <label for="investment">Enter Investment Amount ($):</label>
            <input type="number" step="any" class="form-control" id="investment" name="investment" required>
        </div>
        <button type="submit" class="btn btn-primary">Calculate Returns</button>
    </form>
    
    {% if results %}
    <h2 class="mt-5">Individual Asset Predictions</h2>
    <p><em>Test Period: January 2023 – March 2023</em></p>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Asset</th>
                <th>Cumulative Return (%)</th>
                <th>Predicted Value ($)</th>
            </tr>
        </thead>
        <tbody>
            {% for asset, data in results.items() %}
            <tr>
                <td>{{ asset }}</td>
                <td>{{ (data.Cumulative_Return * 100) | round(2) }}%</td>
                <td>${{ data.Predicted_Value | round(2) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <h2 class="mt-5">Equal-Weighted Portfolio Prediction</h2>
    <p>
        For the equal-weighted portfolio, all assets with a positive cumulative return over the test period are equally weighted.
        Each asset receives an allocation of 100% divided by the number of assets included.
    </p>
    {% if portfolio.Portfolio_Cumulative_Return is not none %}
      <p><strong>Portfolio Cumulative Return (%):</strong> {{ (portfolio.Portfolio_Cumulative_Return * 100) | round(2) }}%</p>
      <p><strong>Portfolio Predicted Value ($):</strong> ${{ portfolio.Portfolio_Predicted_Value | round(2) }}</p>
      <h3 class="mt-3">Equal Allocation Composition</h3>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Asset</th>
            <th>Allocation (%)</th>
          </tr>
        </thead>
        <tbody>
          {% for asset, alloc in portfolio_composition.items() %}
          <tr>
            <td>{{ asset }}</td>
            <td>{{ alloc }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No positive-performing assets found to create an equal-weighted portfolio.</p>
    {% endif %}
    
    <h2 class="mt-5">Optimized Portfolio Prediction</h2>
    <p>
        In the optimized approach, we use the historical training data to compute each asset’s average daily return.
        Assets with higher historical average daily returns receive a greater allocation.
        The optimized allocation weights are computed proportionally to each asset's average daily return (only considering those with a positive cumulative return in the test period).
    </p>
    {% if optimized_portfolio.Portfolio_Cumulative_Return is not none %}
      <p><strong>Optimized Portfolio Cumulative Return (%):</strong> {{ (optimized_portfolio.Portfolio_Cumulative_Return * 100) | round(2) }}%</p>
      <p><strong>Optimized Portfolio Predicted Value ($):</strong> ${{ optimized_portfolio.Portfolio_Predicted_Value | round(2) }}</p>
      <h3 class="mt-3">Optimized Allocation Composition</h3>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Asset</th>
            <th>Optimized Allocation (%)</th>
          </tr>
        </thead>
        <tbody>
          {% for asset, alloc in optimized_composition.items() %}
          <tr>
            <td>{{ asset }}</td>
            <td>{{ alloc }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No optimized portfolio available.</p>
    {% endif %}
    
    <h3 class="mt-5">Additional Portfolio Metrics (Equal-Weighted)</h3>
    {% if metrics %}
    <ul>
        <li><strong>Average Daily Return (%):</strong> {{ (metrics["Average Daily Return"] * 100) | round(2) }}%</li>
        <li><strong>Volatility (Std Dev %):</strong> {{ (metrics["Volatility"] * 100) | round(2) }}%</li>
        <li><strong>Sharpe Ratio:</strong> {% if metrics["Sharpe Ratio"] is not none %}{{ metrics["Sharpe Ratio"] | round(4) }}{% else %}N/A{% endif %}</li>
    </ul>
    {% else %}
      <p>No portfolio metrics available.</p>
    {% endif %}
    
    <h2 class="mt-5">Correlation Matrix (Training Data: 2022 - 2024)</h2>
    <p>The correlation matrix is based on daily returns computed from the training data over the period January 2022 – December 2024.</p>
    <div class="table-responsive">
        {{ correlation_html | safe }}
    </div>
    {% endif %}
</div>
</body>
</html>